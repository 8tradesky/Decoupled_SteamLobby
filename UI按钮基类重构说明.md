# UI按钮基类重构说明

## 重构概述

经过考虑UI布局的实际情况，决定回到原来的设计方式：`UI按钮基类` 直接继承自 `Button`，并复制 `UI界面基类` 的状态管理功能，避免在UI布局时出现节点层级问题。

## 设计决策

### 为什么回到原来的设计？

1. **UI布局问题**：Control节点下挂Button子节点会导致布局问题
   - 按钮的位置、大小、锚点等属性难以控制
   - 在UI编辑器中操作复杂
   - 可能影响响应式布局

2. **简单直接**：直接继承Button更符合Godot的设计理念
   - 节点类型明确
   - 编辑器支持更好
   - 代码更直观

3. **功能完整**：虽然有一些代码重复，但功能完整且稳定

## 最终架构

```
Button
└── UI按钮基类 (extends Button)
    └── 具体按钮类 (extends UI按钮基类)
```

## 主要特点

### 1. 继承关系
```gdscript
class_name UI按钮基类
extends Button
```

### 2. 状态管理功能
- 自动注册到UI状态管理器
- 支持启用/禁用状态列表
- 提供状态查询和切换方法

### 3. 生命周期管理
- 自动注册和取消注册
- 支持手动控制注册时机

## 使用示例

```gdscript
extends UI按钮基类

func _init():
	按钮名称 = "my_button"
	启用状态列表 = [UIStateManager.UIState.MAIN_MENU]
	禁用状态列表 = [UIStateManager.UIState.IN_LOBBY]

func _按钮初始化() -> void:
	text = "我的按钮"
	pressed.connect(_on_pressed)

func _on_pressed() -> void:
	print("按钮被点击")
```

## 优势

1. **布局友好**：直接在Button节点上工作，无布局问题
2. **编辑器支持**：Godot编辑器完全支持Button节点
3. **类型安全**：明确的Button类型，编译时检查
4. **简单直观**：代码结构清晰，易于理解
5. **功能完整**：包含所有必要的状态管理功能

## 代码复用策略

虽然无法通过继承复用UI界面基类的代码，但通过以下方式保持一致性：

1. **相同的API设计**：使用相似的接口和方法名
2. **统一的状态管理**：都通过UIStateManager进行状态管理
3. **一致的注册机制**：使用相同的注册/取消注册逻辑

## 注意事项

1. **代码重复**：与UI界面基类有一些重复的状态管理代码
2. **维护成本**：需要同时维护两个基类的相似功能
3. **功能同步**：当UI界面基类更新时，需要同步更新UI按钮基类

## 总结

虽然这种设计有一些代码重复，但在实际使用中更加稳定和可靠。UI布局的便利性和编辑器的良好支持是更重要的考虑因素。这种设计在功能完整性和使用便利性之间取得了良好的平衡。
